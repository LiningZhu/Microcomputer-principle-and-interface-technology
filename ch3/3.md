### 数据传送指令

数据传送指令是汇编语言中使用最频繁的指令，通常细分为通用数据传送指令、端口输入输出指令、地址传送指令和标志寄存器传送指令。

##### **1.** 通用数据传送指令

###### （1） MOV

指令格式：MOV dst, src

功能：数据传送，把 src 的内容传送到dst 中。

说明：把源操作数复制到目的操作数中，它可以实现：

①	立即数到通用寄存器的数据传送例如：

 MOV AL, 4 ;AL=4 

MOV AX, 1000H ;AX=1000H 

MOV SI, 037BH ;SI=037BH 

但是： MOV DS, 2000H ;语法错误，不能用立即数给段寄存器赋值。 

应该为:MOV AX, 2000 

​             MOV DS, AX

②	立即数到存储单元的数据传送例如：

MOV	WORD PTR[DI], 2000H

将立即数 2000H 传送到内存单元，内存单元的地址以间接寻址的方式由 DI 提供。设

DS=3000H，DI=1500H，目的操作数的物理首地址为 31500H.

PTR 是属性运算符，功能为修改操作数的类型。WORD PTR 的作用是将操作数的类型设置为字类型，BYTE PTR 将操作数的类型设置为字节类型。例如：

MOV	BYTE PTR[SI], 4AH

将立即数 4AH 传送到内存单元，内存单元的地址以间接寻址的方式由 SI 提供，传送一个字节。

MOV	[DI], 04AH	;语法错误：源和目的操作数的类型都不确定。

这条指令不可用，因为源和目的操作数的类型都不确定，指令执行结果也不确定，这种情况称为二异性。指令执行时可能传送一个字节，将立即数 4AH 传送给[DI]指明的内存单元， 也可能传送两个字节，4A 赋给内存单元[DI]，0 赋给[DI+1]。

MOV 指令中的两个操作数的类型必须至少有一个是确定的，另一个依附这一个。属性运算符PTR 帮助我们确定存储器操作数的类型。

③	CPU 内部寄存器之间的数据传送例如：

MOV AL, BL ;BL 传送给 AL，传送一个字节。 

MOV AX, BX ;BX 传送给 AX，传送一个字。 

MOV DS, AX ;给数据段寄存器赋值。 

MOV SI, BP ;BP 传送给 SI，传送一个字。

④ 寄存器与存储单元之间的数据传送例如：

MOV AL, [2000H] ;将 2000H 单元的内容传送给 AL，传送一个字节。

MOV AX, [SI] ;将以 SI 为首地址的连续两个内存单元的数据传送给 AX。 

MOV [3200H], CX ;将CL 存入 3200H 单元，将CH 存入 3201H 单元。 

MOV ARRY[DI], DL ;将 DL 的内容存入 ARRY+DI 的内存单元中。 

MOV DL, [BX] [SI] ;将 BX+SI 内存单元的数据传送给 DL

⑤ 存储单元之间的数据传送

不能用一条 MOV 指令实现内存单元之间的数据传送。8086 汇编语法规定MOV 指令中两个操作数不能同时为存储器操作数。要实现存储单元之间的数据传送，需要两条指令。例如：

MOV	[DI], [SI]	;语法错误。

应该为：

MOV		AX, [SI] MOV	[DI], AX

使用 MOV 指令时注意：

①	MOV 指令不影响标志寄存器的任何标志位。

②	源和目的操作数不可同时为存储器操作数。

③	源和目的操作数必须等长，即同时为字节类型或字类型。

④	不能用立即数给段寄存器赋值。

⑤	不允许给CS 赋值。

⑥	MOV 指令不能访问 IP 和Flags

###### （2） PUSH，POP

PUSH 和POP 是堆栈操作指令助记符。堆栈是程序在内存中开辟的一个数据区，用以保存寄存器或存储器中暂时不用而又必须保存的数据。程序中堆栈是用段定义语句在内存中定义的一个堆栈段，堆栈段的段基址存放在 SS 寄存器，段内偏移地址存放在 SP 寄存器中， SP 也常称为堆栈指针，它总是指向栈顶。

堆栈是一种线性表，只在栈顶（低地址端）进行输入输出操作。CPU 对堆栈的操作采用先进后出（或后进先出）存取方法。CPU 把数据存入堆栈称为压入堆栈PUSH，从堆栈中取出数据称为弹出堆栈POP。压入堆栈时堆栈增长，堆栈指针 SP 减小，向低地址方向移动； 弹出堆栈时堆栈减小，堆栈指针 SP 增大，向高地址方向（栈底）移动。如图 3-6 所示。

指令格式：

PUSH	src	;压栈指令

POP	dst	;出栈指令

PUSH 指令把操作数压入堆栈，执行过程为：

①	src 的高 8 位存入[SP-1]，src 的低 8 位存入[SP-2]

②	SP-2 送 SP

例如：

设 SS=2000H，SP=102H，AX=623EH，执行下面指令后： 

PUSH	AX

AX 的数据 62H 存入 20101H 单元，3EH 存入 20100H 单元，SP=0100H。

POP 指令把操作数弹出到dst 中，执行过程为：

①	把[SP]的内容弹出到 dst 的低 8 位，把[SP+1]的内容弹出到dst 的高 8 位

②	SP+2 送 SP

例如：设 SS=2000H，SP=102H，执行下面指令后： 

POP	AX

SS=2000H，SP=104H，AX=79FFH。

堆栈操作指令属于单操作数指令，操作数可以是寄存器，也可以是存储器。堆栈指令的操作数必须是字类型，可以是 16 位的通用寄存器或段寄存器，也可以是两个连续的内存单元，可以采用任何寻址方式。8086CPU 不允许立即数作为堆栈操作的操作数，CS 不能作为出栈指令的操作数。堆栈指令不影响任何标志位。

例如：	

PUSH	DI

PUSH	DS

PUSH	CS

PUSH	WORD PTR[1000H] 

PUSH	WORD PTR[SI] 

PUSH	WORD PTR[BP+6] 

POP	SI

POP	DS

POP	WORD PTR[1000H] 

POP	WORD PTR[SI]

POP	WORD PTR[BX+DI]

堆栈操作常用来传递函数的参数。程序中压栈操作和出栈操作常常成对出现，以保持堆栈的平衡。

##### **2.** 输入输出指令IN，OUT

8086CPU 对所有输入输出端口统一管理，提供了一个与内存储器地址空间分开的、完全独立的地址空间，I/O 端口的地址有 8 位和 16 位两种形式。8086CPU 对 I/O 端口的管理与对内存储器的管理不同，输入输出指令中操作数的寻址方式也不同，是输入输出指令特有的。

- 直接端口寻址方式：当端口地址是 8 位的二进制数时，可以在指令中直接使用该地址。

- 寄存器间接寻址方式：当端口地址为 16 位，不能直接使用，需要预先将其传送到

DX 寄存器中，并且只能是 DX 作为间接寻址寄存器。

8086CPU 无论从端口输出数据还是输入数据，都要通过累加器 AL 或 AX，所以输入输出指令又称为累加器专用传送指令。

###### （1） 输入指令 IN

格式：     IN ACC, port ;直接寻址，8 位 port 为立即数端口地址。

​     或        IN ACC, DX ;间接寻址，DX 存有 16 位端口地址。 

例如：     IN AL, 60H ;从 60H 端口输入一个字节。

​                 IN AX, 60H ;从 60H 端口输入一个字 。

​                 IN AL, DX ;从 DX 端口中输入一个字节。

​                 IN AX, DX ;从 DX 端口中输入一个字。

###### （2） 输出指令OUT

 格式：    OUT port, ACC ;直接寻址，port 为 8 位立即数端口地址。

​     或        OUT DX, ACC ;间接寻址，DX 存有 16 位端口地址。 

 例如：    OUT 60H, AL ;AL 从 60H 端口输出。 

​                 OUT 60H, AX ;AX 从 60H 端口输出。 

​                 OUT DX, AL ;AL 从 DX 端口中输出。 

​                 OUT DX, AX ;AX 从 DX 端口中输出。

##### 堆栈初始化

堆栈初始化应该加载堆栈段寄存器 SS 和堆栈指针寄存器 SP。通常把堆栈段的栈底地址装入 SS。例如，如果堆栈段位于存储单元 20000H~2FFFFH 处，则应该设置 SS=2000H， SP=0000H。这样 SP 实际指向 2FFFFH，因为操作时首先 SP 减 1，然后才把第一个字节压栈。所有的段都是自然循环的，段的顶部就是段的底部。

汇编语言中堆栈段的设置是由汇编（MASM）和连接程序（LINK）自动设置的，除非有特殊需要改变这些初始化值，否则不必要加载 SS 和 SP。