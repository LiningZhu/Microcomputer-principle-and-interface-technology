### 8086CPU寻址方式

##### 8086CPU 指令系统的寻址方式有两类：

- 获得指令中操作数地址的方法。指令的操作数有三种类型：立即数、寄存器操作数和存储器操作数。立即数作为指令的一部分出现在指令中，随着 CPU 取指令的动作进入 CPU 内，不需要再寻址；寄存器操作数本就在 CPU 内部，寄存器的符号就是地址；存储器操作数在内存中，指令只能给出内存单元的偏移地址，而且这个地址常常并不是指令需要的操作数有效地址，要通过某种计算方法才能得到操作数的最终地址。这个过程称为操作数寻址。操作数寻址通常在数据段、附加数据段或堆栈段，相应的段基址由段寄存器 DS、ES 或 SS 提供。指令采用什么样的方法求得有效地址，与指令的功能紧密相关。汇编语言的寻址方式主要指的是存储器操作数的寻址方式。

- 获得要执行的下一条指令的地址的方法。在正常情况下，每当 BIU 取完一条指令， 程序计数器 IP 自动指向下一条，程序就按照指令的先后顺序执行。但当程序执行转移指令或子程序调用指令时，程序的执行顺序必须按照指令的要求改变，这时需要寻找下一条指令的地址。这类寻址发生在程序代码段内，由CS 段寄存器提供段基址。这一类寻址方式只涉及转移指令和子程序调用指令，在介绍相关指令时再详细讲解。

##### 操作数的8种寻址方式 

###### **1.** 立即寻址

操作数是立即数，可以是 8 位或 16 位的二进制数，也可以是字符常数。例如：

| MOV  | AX, 2000H | ;2000H 是立即数操作数    |
| ---- | --------- | ------------------------ |
| MOV  | AH, ’A’   | ;’A’是字符常数，等于 41H |
| ADD  | AL, 6     | ;6 是立即数操作数        |

立即数作为操作数，这个操作数的寻址方式称为立即寻址，其实它不用寻址。立即数操作数只能作源操作数，不能作为目的操作数。

###### **2.** 直接寻址

操作数在内存中，指令中直接给出操作数所在的内存单元的偏移地址。可以是数值形式的地址，也可以用符号表示。用符号表示的地址称为符号地址。例如：

MOV	BL, [2000H]

将偏移地址为 2000H 的内存单元的内容传送给 BL 寄存器。操作数[2000H]的寻址方式为直接寻址，方括号表示地址。如果 2000H 单元存储的数据为 55H，上面指令执行后BL=55H。

再如：	MOV	BX, [3200H]

将偏移地址为3200H 为首地址的连续两个内存单元的内容传送给BX 寄存器。操作数[3200H] 的寻址方式为直接寻址。如图 3-3 所示，3200H 单元存储的数据为 F8H，3201H 单元存储的数据为 03H，上面的指令执行后 BX=03F8H。

注意：BX 为 16 位的寄存器，决定了这条指令为 16 位的数据传送指令。

汇编语言中常常用一个符号代替数值，如 BUFF 代替 3200H，则上述指令可写为： MOV	BX, [BUFF]	;或写为	MOV	BX, BUFF

BUFF 称为符号地址，它的寻址方式仍为直接寻址方式。BUFF 需要在程序开始处予以定义。

8088/8086CPU 采用分段的方式管理内存储器，CPU 读写内存时使用段基址和段内偏移地址，段基址指明段的起始位置，段内偏移地址指明相对于段起始地址的位移量，通常将段基址和段内偏移地址称为逻辑地址。汇编指令中存储器操作数的地址都是逻辑地址，例如上面指令中的[2000H]和[3200H]，都是段内偏移地址，它们的段基址由 DS 指明。在通常情况下，存储器操作数的默认在数据段，段基址在 DS。在特殊说明的情况下，存储器操作数的段基址也可以替换为 CS、ES 或 SS。表 3-1 说明了 8088/8086CPU 系统中逻辑地址的来源。

表 3-1 8088/8086CPU 系统中逻辑地址的来源

| 操作类型         | 默认段 | 可替换的段 | 偏移地址       |
| ---------------- | ------ | ---------- | -------------- |
| 取指令           | CS     | 无         | IP             |
| 堆栈操作         | SS     | 无         | SP             |
| BP 作基地址      | SS     | CS,DS,ES   | 由寻址方式决定 |
| BX 作基地址      | DS     | CS,ES,SS   | 由寻址方式决定 |
| 通用数据读写     | DS     | CS,ES,SS   | 由寻址方式决定 |
| 串操作中的源串   | DS     | CS,ES,SS   | SI             |
| 串操作中的目的串 | ES     | 无         | DI             |

CPU 执行指令时，由段基址和偏移地址产生 20 位的物理地址，从中取出操作数。例如：

MOV	BL, [2000H]

设 DS=1200H，上面指令的执行过程为：CPU 通过内部的地址加法器，由逻辑地址计算得到20 位的物理地址：1200HX10H+2000H=14000H，从 14000H 内存单元取出 55H 传送给 BL 寄存器。

如果操作数的段基址不是DS 段，指令要特别说明。例如在 ES 段，指令应书写为：

MOV	BL, ES:[2000H]

这种用法称为段超越，物理地址为ESX10H+2000H。

###### **3.** 寄存器寻址

操作数在CPU 内部的寄存器中，例如：

MOV	BL, [2000H] ;操作数BL 的寻址方式为寄存器寻址。

ADD	AX, BX	;源和目的操作数的寻址方式都是寄存器寻址。

###### **4.** 寄存器间接寻址

操作数在内存中，内存单元的偏移地址存放在寄存器中。例如：

MOV	AX, [SI]	;操作数[SI]的寻址方式为寄存器间接寻址。

上述指令的功能为：SI 的内容为内存单元的偏移地址，DS 为段基址，以 DSX10H+SI 为首地址，取出连续两个内存单元的数据传送给 AX。如果 DS=2000，SI=02H，参照图 3-4， 上面指令的执行结果为AX=C396H

再如：

| MOV  | DX, [DI] | ;将 DS:[DI]指明的连续两个内存单元的数据传送到 DX。 |
| ---- | -------- | -------------------------------------------------- |
| MOV  | [BX], AX | ;AX 的内容传送到 DS:[BX]指明的连续两个内存单元     |

中。

MOV	CX, [BP]	;将 SS:[BP]指明的连续两个内存单元的数据传送到 CX。

操作数[DI]、 [BX]、 [BP]的寻址方式都是寄存器间接寻址。8086CPU 中能够作为寄存器间接寻址方式使用的寄存器只有 4 个：BX、BP、SI、DI。这 4 个寄存器在作为间接寻址使用时，要用[ ]申明，这时常称为它们为地址指针或间址寄存器。BP 在作为间址寄存器时， 段基址默认为 SS；其它 3 个的默认段基址为DS。都可以段超越。例如：

MOV	DX, ES:[DI]

上述指令的功能为：从物理地址为ESX10H+DI 的内存单元取出两个字节的数据传送给DX。

###### **5.** 寄存器相对寻址

操作数在内存中，内存单元的偏移地址一部分由间接寻址寄存器提供，一部分是指令给定的 8 位或 16 位地址位移量，二者相加形成操作数的有效地址。例如：

MOV	AX, [BX+DATA]	;将以BX+DATA 为首地址的连续两个内存单元的数据传送给 AX。

MOV	AL, [SI+20H]	;将以 SI+20H 为地址的内存单元的数据传送给AL。

MOV	CX, [DI+DATA]	;将以 DI+DATA 为首地址的连续两个内存单元

的数据传送给 CX。

MOV	DX, [BP+DATA]	;将以 BP+DATA 为首地址的连续两个内存单元

的数据传送;给DX。

上述指令的书写格式很灵活，也可以如下书写：

MOV	AX, [BX]+DATA MOV	AL, 20H [SI] 

MOV	CX, DATA [DI] MOV	DX, DATA+ [BP]

寄存器相对寻址方式对寄存器的要求与寄存器间接寻址一样，只有 4 个寄存器：BX、BP、SI、DI 可以使用，并且要用[ ]申明。BP 在寄存器相对寻址时，段基址默认为 SS，其它 3 种情况段基址默认为DS。

这种寻址方式可用于存取数据表中的数据，用间址寄存器存放数据表首地址，地址位移量指明要存取表中的哪一个数据，可以方便地存取数据表中的任何数据。

###### **6.** 基址变址寻址

操作数在内存中，基址寄存器和变址寄存器相加作为操作数的偏移地址。例如：

MOV	AX, [BX] [SI] ;将 BX+SI 为首地址的连续两个内存单元的数据送给

AX。

MOV	CX, [BP] [DI]	;将 BP+DI 为首地址的连续两个内存单元的数据送给CX。

8086CPU 中寄存器 BX 和 BP 为基址寄存器，SI 和DI 为变址寄存器。这种寻址方式中，一个基址寄存器加一个变址寄存器构成操作数，操作数的形式只有 4 种：

[BX] [SI]

[BX] [DI]

[BP] [SI]

[BP] [DI]

这种寻址方式里段基址是DS 还是SS 呢？8086 汇编规定以基地址为主，如果基址寄存器为 BP，则操作数的段基址默认由 SS 提供；若 BX 为基址寄存器，则段基址默认由 DS 提供。例如：

MOV AX, [BX] [DI];源操作数的物理地址为：DSX10H+BX+DI

MOV [BP] [SI], DX;目的操作数的物理地址为：SSX10H+BP+SI

基址变址寻址方式要求必须一个基址和一个变址组合，不允许两个基址或两个变址组合。下面指令是错误的。

MOV	AX, [BX] [BP]

MOV	AX, [SI] [DI]

基址变址寻址方式的主要用途是寻址存储器数组中的元素。将数组的首地址装入基址寄存器，而把要存取的元素的序号存入变址寄存器中，通过修改变址寄存器的内容来访问数组中的各个元素，它比寄存器相对寻址更加灵活。

###### **7.** 基址变址相对寻址

操作数在内存中，操作数的地址由基址寄存器加上变址寄存器再加上地址位移量构成。如果基址寄存器为 BP，则段基址默认由 SS 提供；若 BX 为基址寄存器，则段基址默认由DS 提供。例如：

MOV AX, DATA[BX] [SI] MOV AX, [BP] [DI] DATA

指令也可以书写为：

MOV AX, [DATA+BX+SI] MOV AX, [DATA+BX] [SI] MOV AX, DATA[BX+SI]

这种寻址方式主要用于二维数组操作。地址位移量作为数组首地址，基址寄存器寻址行， 变址寄存器寻址列，可以很方便实现数据阵列检索。

基址变址相对寻址方式要求必须一个基址和一个变址组合，不允许两个基址或两个变址组合。

###### **8.** 隐含寻址

操作码隐含地指明操作数的地址，例如乘法指令、字符串操作指令。

MUL  BL	;AL 乘以 BL，结果存在 AX 中。

MOVSB	;把 DS:SI 指明的内存单元的数据传送到 ES:DI 指明的内存单元

中。