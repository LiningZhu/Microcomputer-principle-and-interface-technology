## cache

为了缓解CPU和主存之间存取速度的矛盾，在CPU和主存之间插入一小块SRAM，称为Cache。CPU在读取指令或数据时总是先在cache中寻找，若找到则读入，若找不到再到主存中寻找。

![](http://m.qpic.cn/psc?/V13PUOHK2RFsMP/U3..NSiujzLMR7a*2QgXbSub6E3Nlqul9nAo6M2bRdj6lkmvw036.MlMwI6b1F3MdilzcVElYSGD*i9P1mtrJw!!/b&bo=xwGJAMcBiQADCSw!&rf=viewer_4)

Cache是一个高速的存储器系统，由SRAM构成，存取时间小于10ns。它位于微处理器和主存储器之间。现在微机系统的主存储器多采用DRAM构成，DRAM靠电容存储信息，所以到目前为止，最快DRAM的存取时间是40ns。80386所允许的存储器存取时间是50ns，之后的CPU所允许的存取时间越来越短，显然DRAM不能满足快速发展的CPU的存取要求。
为了缓解CPU和主存之间存取速度的矛盾，在CPU和主存之间插入一小块SRAM，称为Cache，将当前正在执行的指令及相关联的后继指令从内存读到Cache，使CPU执行下一条指令时，从Cache中读取。

#### 工作原理

1.如果CPU在读取指令或数据时在cache中没有找到（未命中），而是到主存中寻找。系统就将当前的指令及相关联的后继指令集从内存读到Cache，使CPU执行下一条指令时，从Cache中读取（命中）。
2.把一段时间内一定范围里的信息成批地从主存读到cache中，使CPU到cache中读取后继的指令和数据，减少CPU访问主存的次数，从而缓解CPU和主存之间存取速度的矛盾。

#### 命中和未命中

`把一段时间内一定范围里的信息成批地从主存读到cache中，使CPU到cache中读取后继的指令和数据，减少CPU访问主存的次数，从而缓解CPU和主存之间存取速度的矛盾。`
CPU在读取下一条指令或数据时总是先在cache中寻找，若找到则读入，称为命中；若找不到再到主存中寻找，称为未命中。
CPU在读取未命中的指令和数据时，也把与其相关联的一定范围内的指令和数据一并读入cache中，以保证下次命中，同时将现在在cache中的指令和数据调出cache，存入主存中。

**Cache的工作基于：**

- **程序和数据访问的局部性；**
  程序在运行期间，在一个较短的时间间隔内，CPU对内存的访问往往集中在存储器的一个很小的范围内。这是因为程序指令在内存中是连续存放的，而且程序结构多采用循环、子程序，这使得CPU对内存的访问具有时间上集中分布的倾向。程序执行时使用的数据，也具有这种局部性特征。

#### 关于命中率

**Cache的命中率一般为90%。**
命中率与cache的容量有关，容量越大，命中率越高，但是命中率与容量并不是成正比。
当cache的容量大到一定程度，命中率就不再随着容量的增加而明显地增长。所以cache的容量与主存容量应该保持一定的比例，使CPU保持较高的命中率，同时微机的成本又没有大幅增加。
Cache的容量也与应用程序有关。如果经常运行的应用程序较小，就可以使用较小是cache。如果应用程序很大而且要经常访问大块的数据，就尽可能使用较大的cache。

#### 补充

80386只拥有二级cache，外部的cache。
80486包含一个一级cache，8KB。
Pentium系统中采取了多级cache的结构，一级cache集成在CPU芯片内部，容量为16KB或者32KB，分为两部分，一个数据cache，一个指令cache，；二级cache在CPU芯片之外，大小256KB、 512KB、2MB等。

- Cache技术完全由硬件实现，对程序员来说，cache就像不存在。